<!-- Generated template for the ConnectionComponent component -->
<div class="connectionDetail" *ngIf="details">
  <ion-card color="primary">
    <ion-card-content *ngIf="!expandedDetails">
      <ion-row>
        <ion-col col-10>
          <ion-card-title>Deine Reise</ion-card-title>
        </ion-col>
        <ion-col col-2 align-self-end>
          <button ion-button round icon-only clear color="light" (click)="toggleDetails()">
            <ion-icon name="{{expandedDetails? 'ios-arrow-down' : 'ios-arrow-up' }}"></ion-icon>
          </button>
        </ion-col>
      </ion-row>
      <ion-row>
        <ion-col col-12>
          <ion-row>
            <ion-col col-1>
              <ion-icon name="pin"></ion-icon>
            </ion-col>
            <ion-col col-11>
              {{ getVBBDate(connection.departure) }}
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col col-12>
          <div class="stationName">
            {{ connection.origin.name }}
          </div>
        </ion-col>
      </ion-row>
      <hr/>
      <ion-row>
        <ion-col col-12>
          <h3> Reisezeit: {{ getVBBTravelTime(connection.departure, connection.arrival) }}</h3>
        </ion-col>
      </ion-row>
      <hr/>
      <ion-row>
        <ion-col col-12>
          <ion-row>
            <ion-col col-1>
              <ion-icon name="flag"></ion-icon>
            </ion-col>
            <ion-col col-11>
              {{ getVBBDate(connection.arrival) }}
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col col-12>
          <div class="stationName">
            {{ connection.destination.name }}
          </div>
        </ion-col>
      </ion-row>
    </ion-card-content>
    <ion-card-content class="centeredText" (click)="toggleDetails()" *ngIf="expandedDetails">
      <ion-row class="centeredText">
        <ion-col col-5>
          {{ getVBBDate(connection.departure) }}
        </ion-col>
        <ion-col col-2 class="centeredText">
          <ion-icon class="medium-ion-icon" name="time"></ion-icon>
        </ion-col>
        <ion-col col-5>
          {{ getVBBDate(connection.arrival) }}
        </ion-col>
      </ion-row>
      <ion-row class="centeredText">
        <ion-col col-5>
          <div class="">
            {{ connection.origin.name }}
          </div>
        </ion-col>
        <ion-col col-2>
          <ion-icon class="medium-ion-icon centeredText" name="arrow-round-forward"></ion-icon>
        </ion-col>
        <ion-col col-5>
          <div class="">
            {{ connection.destination.name }}
          </div>
        </ion-col>
      </ion-row>
    </ion-card-content>
  </ion-card>

  <div *ngFor="let step of connection.legs; let lst = last; let i = index">
    <ion-card color="light" *ngIf="step.travel_mode === 'walking'">
      <img src=""/>
      <ion-card-content>
        <h2>
          <ion-icon name="walk"></ion-icon>
        </h2>
      </ion-card-content>
    </ion-card>

    <ion-card *ngIf="step.id" color="light" >
      <ion-card color='{{step.line.product}}'>
        <ion-card-header>
          <ion-row>
            <ion-col col-4>
              {{ step.line.name }}
            </ion-col>
            <ion-col col-1>
              <ion-icon name="arrow-round-forward"></ion-icon>
            </ion-col>
            <ion-col col-7>
              {{ step.direction }}
            </ion-col>
          </ion-row>
        </ion-card-header>
      </ion-card>

      <ion-card-content>
        <i>
          <ion-row>
            <ion-col col-3>
              Abfahrt
            </ion-col>
            <ion-col col-2>
              Gleis
            </ion-col>
            <ion-col col-6>
              Bahnhof/Haltestelle
            </ion-col>
            <ion-col col-1 align-self-end (click)="toggleStationDetails(step.id, step.origin.id)">
              <ion-icon *ngIf="visibleElement === (step.id+step.origin.id)" name="close"></ion-icon>
              <ion-icon *ngIf="visibleElement !== (step.id+step.origin.id)" name="add"></ion-icon>
            </ion-col>
          </ion-row>
        </i>

        <h2>
          <ion-row (click)="toggleStationDetails(step.id, step.origin.id)">
            <ion-col col-3>
              {{ getVBBTime(step.departure) }}
            </ion-col>
            <ion-col col-2>
              {{ step.departurePlatform? step.departurePlatform : "?" }}
            </ion-col>
            <ion-col col-7>
              {{ step.origin.name }}
            </ion-col>
          </ion-row>
        </h2>

        <div class="mapContainer" [hidden]="visibleElement !== (step.id+step.origin.id)">
          <agm-map [latitude]="step.origin.location.latitude" [longitude]="step.origin.location.longitude" [zoom]="16">
            <agm-marker [latitude]="step.origin.location.latitude" [longitude]="step.origin.location.longitude">
              <agm-info-window>{{ step.origin.name }}</agm-info-window>
            </agm-marker>
          </agm-map>
        </div>

        <hr/>
        <ion-row>
          <ion-col col-4>
            Fahrtzeit:
          </ion-col>
          <ion-col col-8>
            {{getVBBTravelTime(step.departure, step.arrival)}}
          </ion-col>
        </ion-row>
        <hr/>

        <i>
          <ion-row>
            <ion-col col-3>
              Ankunft
            </ion-col>
            <ion-col col-2>
              Gleis
            </ion-col>
            <ion-col col-6>
              Bahnhof/Haltestelle
            </ion-col>
            <ion-col col-1 align-self-end (click)="toggleStationDetails(step.id, step.destination.id)">
              <ion-icon *ngIf="visibleElement === (step.id+step.destination.id)" name="close"></ion-icon>
              <ion-icon *ngIf="visibleElement !== (step.id+step.destination.id)" name="add"></ion-icon>
            </ion-col>
          </ion-row>
        </i>

        <h2>
          <ion-row (click)="toggleStationDetails(step.id, step.destination.id)">
            <ion-col col-3>
              {{ getVBBTime(step.arrival) }}
            </ion-col>
            <ion-col col-2>
              {{ step.arrivalPlatform? step.arrivalPlatform : "?" }}
            </ion-col>
            <ion-col col-7>
              {{ step.destination.name }}
            </ion-col>
          </ion-row>
        </h2>

        <div class="mapContainer" [hidden]="visibleElement !== (step.id+step.destination.id)">
          <agm-map [latitude]="step.destination.location.latitude" [longitude]="step.destination.location.longitude" [zoom]="16">
            <agm-marker [latitude]="step.destination.location.latitude" [longitude]="step.destination.location.longitude">
              <agm-info-window>{{ step.destination.name }}</agm-info-window>
            </agm-marker>
          </agm-map>
        </div>
      </ion-card-content>
    </ion-card>

    <ion-card color="light" *ngIf="!lst && step.mode !== 'walking' && connection.legs[i+1].mode !== 'walking'">
      <ion-row class="transitTime">
        <ion-col col-2>
          <ion-icon class="medium-ion-icon" name="log-out"></ion-icon>
        </ion-col>
        <ion-col col-8>Zeit zum umsteigen {{getVBBTravelTime(step.arrival, connection.legs[i+1].departure)}}</ion-col>
        <ion-col col-2>
          <ion-icon class="medium-ion-icon" name="log-in"></ion-icon>
        </ion-col>
      </ion-row>
    </ion-card>
  </div>
  <ion-card>
    <button ion-button block (click)="startLiveTracking()">
      Starte Live Updates
    </button>
  </ion-card>
</div>

<div class="connectionOverview" *ngIf="!details">
  <ion-card class="infoCard" color="">
    <ion-card-content>
      <ion-row>
        <ion-col col-12>
          <ion-row>
            <ion-col col-2>
              <ion-icon name="pin"></ion-icon>
            </ion-col>
            <ion-col col-10>
              {{ getVBBDate(connection.departure) }}
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col col-12>
          <div class="stationName">
            {{ connection.origin.name }}
          </div>
        </ion-col>
      </ion-row>
      <hr/>
      <h3> Reisezeit: {{ getVBBTravelTime(connection.departure, connection.arrival) }}</h3>
      <hr/>
      <ion-row>
        <ion-col col-12>
          <ion-row>
            <ion-col col-2>
              <ion-icon name="flag"></ion-icon>
            </ion-col>
            <ion-col col-10>
              {{ getVBBDate(connection.arrival) }}
            </ion-col>
          </ion-row>
        </ion-col>
        <ion-col col-12>
          <div class="stationName">
            {{ connection.destination.name }}
          </div>
        </ion-col>
      </ion-row>
    </ion-card-content>
  </ion-card>
  <div *ngFor="let step of connection.legs; let lst = last;let i = index">
    <ion-card color="light" *ngIf="step.mode === 'walking'">
      <ion-card-content>
        <h2>
          <ion-icon name="walk"></ion-icon>
          <ion-icon name="arrow-round-forward"></ion-icon>
          {{ step.destination.name }}
        </h2>
      </ion-card-content>
    </ion-card>
    <ion-card *ngIf="step.id" color='{{step.line.product}}'>
      <ion-card-header>
        <ion-card-title>
          {{ step.line.name}}
        </ion-card-title>
      </ion-card-header>
    </ion-card>
    <ion-card color="light" *ngIf="!lst && step.mode !== 'walking' && connection.legs[i+1].mode !== 'walking'">
      <ion-row class="transitTime">
        <ion-col col-2>
          <ion-icon name="log-out"></ion-icon>
        </ion-col>
        <ion-col col-8>{{getVBBTravelTime(step.arrival, connection.legs[i+1].departure)}}</ion-col>
        <ion-col col-2>
          <ion-icon name="log-in"></ion-icon>
        </ion-col>
      </ion-row>
    </ion-card>
  </div>
</div>

